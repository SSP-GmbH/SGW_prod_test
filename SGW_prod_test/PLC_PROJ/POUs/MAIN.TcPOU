<?xml version="1.0" encoding="utf-8"?>
<TcPlcObject Version="1.1.0.1">
  <POU Name="MAIN" Id="{cf7a1f3b-01b2-485c-af22-ebbbf99dfab4}" SpecialFunc="None">
    <Declaration><![CDATA[ (* POUs/MAIN *)

PROGRAM MAIN

VAR
    (*— user settings —*)
    sDeviceNetId : T_AmsNetId := '5.156.240.208.7.1';      (* leave empty ⇒ local EL6751 *) 
    bSendOnce    : BOOL := TRUE;          (* toggle TRUE → send frame   *)

    (*— CAN frame 0x123, 8 data bytes —*)
    aMsg : ARRAY[0..10] OF BYTE := [
        16#23, 16#01, 8,
        16#11,16#22,16#33,16#44,16#55,16#66,16#77,16#88 ];

    (*— helpers —*)
    trig     : R_TRIG;
    fbWrite  : ADSWRITE;
    bBusy    : BOOL;
    bError   : BOOL;
    nErrId   : UDINT;
END_VAR
]]></Declaration>
    <Implementation>
      <ST><![CDATA[(* one-shot edge from user flag *)
trig( CLK := bSendOnce );

(* call ADSWRITE **every** scan *)
fbWrite(
    NETID   := sDeviceNetId,        (* see section 2 below            *)
    PORT    := 200,                 (* EL6751 AoE port                *)
    IDXGRP  := 16#F921,             (* CAN-Tx mailbox                 *)
    IDXOFFS := 0,
    LEN     := SIZEOF(aMsg),
    SRCADDR := ADR(aMsg),
    WRITE   := trig.Q,              (* 1-cycle pulse → start command  *)
    TMOUT   := T#1s,
    BUSY    => bBusy,
    ERR     => bError,
    ERRID   => nErrId );

(* reset user trigger after completion *)
IF NOT bBusy THEN
    bSendOnce := FALSE;
END_IF
]]></ST>
    </Implementation>
  </POU>
</TcPlcObject>